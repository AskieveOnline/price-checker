<!DOCTYPE html>
<html>
<head>
    <title>Lowest Price Finder</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; max-width: 800px; margin: 0 auto; }
        input { padding: 12px; width: 60%; font-size: 16px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 12px 24px; background: #4285F4; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background: #3367D6; }
        #result { margin-top: 20px; padding: 15px; border-radius: 4px; }
        .price { font-size: 24px; color: #1a73e8; font-weight: bold; }
        .merchant { color: #5f6368; margin-top: 5px; }
        .loading { color: #5f6368; font-style: italic; }
        .error { color: #d93025; background-color: #fce8e6; padding: 10px; }
    </style>
</head>
<body>
    <h1>Find the Lowest Price on Google Shopping</h1>
    <input type="text" id="product" placeholder="Enter product (e.g., iPhone 15)">
    <button onclick="searchPrice()">Search</button>
    <div id="result"></div>

    <script>
        async function searchPrice() {
            const product = document.getElementById("product").value.trim();
            const resultDiv = document.getElementById("result");
            
            if (!product) {
                resultDiv.innerHTML = '<div class="error">Please enter a product name</div>';
                return;
            }

            resultDiv.innerHTML = '<div class="loading">Searching Google Shopping...</div>';

            // Replace with your ScraperAPI key (keep the quotes!)
            const API_KEY = "a4ee6156c39a100b5d4fb2727240e9f9";
            const encodedProduct = encodeURIComponent(product);
            
            try {
                // ScraperAPI call with rendering enabled to bypass blocks
                const response = await fetch(
                    `https://api.scraperapi.com/?api_key=${API_KEY}&render=true&url=https://www.google.com/search?q=${encodedProduct}&tbm=shop`
                );
                
                if (!response.ok) throw new Error(`API error: ${response.status}`);
                
                const html = await response.text();
                
                // Parse HTML to extract prices and merchants
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, "text/html");
                
                // Updated selectors for 2024 Google Shopping layout
                const priceElements = doc.querySelectorAll(".tAxDx, .a8Pemb, .TL92Hc, .g9WBQb, .HRLxBb");
                const merchantElements = doc.querySelectorAll(".aULzUe, .IuHnof, .E5ocAb");
                
                if (priceElements.length === 0) {
                    resultDiv.innerHTML = '<div class="error">No prices found. Google may have blocked the request.</div>';
                    return;
                }
                
                // Extract prices and merchants
                const results = [];
                priceElements.forEach((priceEl, index) => {
                    const priceText = priceEl.textContent.trim();
                    const priceValue = parseFloat(priceText.replace(/[^0-9.]/g, ""));
                    const merchant = merchantElements[index] ? merchantElements[index].textContent.trim() : "Unknown merchant";
                    
                    if (!isNaN(priceValue)) {
                        results.push({
                            price: priceValue,
                            merchant: merchant,
                            raw: priceText
                        });
                    }
                });
                
                if (results.length === 0) {
                    resultDiv.innerHTML = '<div class="error">Found prices but couldn\'t parse them</div>';
                    return;
                }
                
                // Find lowest price
                const lowest = results.reduce((min, current) => 
                    current.price < min.price ? current : min
                );
                
                // Display result
                resultDiv.innerHTML = `
                    <div class="price">$${lowest.price.toFixed(2)}</div>
                    <div class="merchant">From ${lowest.merchant}</div>
                    <div style="margin-top: 20px; font-size: 14px; color: #5f6368;">
                        Found ${results.length} prices | ${new Date().toLocaleString()}
                    </div>
                `;
                
            } catch (error) {
                console.error("Error:", error);
                resultDiv.innerHTML = `
                    <div class="error">
                        Error: ${error.message}<br>
                        Try again later or check your API key
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
